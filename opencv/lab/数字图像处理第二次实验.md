# 实验二 ： 点处理
		 姓名 : 田沛骐 班级 : 计科2003 学号：2020014457
## 实验任务
1. 灰度化图像，并且显示灰度直方图。
                                  **结果** 
![[Pasted image 20221012141632.png]]
![[Pasted image 20221012141901.png]]
该图像为调用自己编写的直方图均衡化函数所得。
![[Pasted image 20221012142019.png]]
该图像为调用opencv库函数所得。

# 核心代码
## 灰度化
``` C++
Mat* grayscale(Mat image) {
	Mat* ret = new Mat(image.size(), CV_8UC1);
	int row = image.rows;
	int col = image.cols;

	for (int i = 0; i < row; i++)
	{
		for (int j = 0; j < col; j++)
		{
			ret->at<uchar>(i, j) = (uchar)(0.2126 * (float)image.at<Vec3b>(i, j)[2]
				+ 0.7152 * (float)image.at<Vec3b>(i, j)[1]
				+ 0.0722 * (float)image.at<Vec3b>(i, j)[0]);
		}
	}
	return ret;
}
```
## 直方图均衡化
```C++
Mat* my_equalizeHist(Mat src) {
	Mat* ret;
	ret = new Mat(src.size(), CV_8UC1);
	int arr[256];
	double probability[256];
	double sum_pro[256];
	memset(arr, 0, sizeof(int) * 256);
	memset(probability, 0.0, sizeof(double) * 256);
	memset(sum_pro, 0.0, sizeof(double) * 256);
	int row = src.rows;
	int col = src.cols;
	//get original distribution
	for (int i = 0; i < row; i++)
	{
		for (int j = 0; j < col; j++)
		{
			int index = src.at<uchar>(i, j);
			arr[index]++;
		}
	}
	//get probability 
	for (int i = 0; i < 255; i++)
	{
		probability[i] = (double)arr[i] / (row * col);
		if (!i) {
			sum_pro[i] = probability[i];
		}
		else
		{
			sum_pro[i] = probability[i] + sum_pro[i - 1];
		}
	}
	for (int i = 0; i < row; i++) {
		for (int j = 0; j < col; j++) {
			ret->at<uchar>(i, j) = sum_pro[src.at<uchar>(i, j)] * 255;
		}
	}
	return ret;
}
```

## 生成灰度直方图
``` C++
void show_Histogram(Mat image) {
	int row = image.rows;
	int col = image.cols;
	int arr[256];
	memset(arr, 0, 256 * sizeof(int));
	for (int i = 0; i < row; i++)
	{
		for (int j = 0; j < col; j++)
		{
			int index = image.at<uchar>(i, j);
			arr[index]++;
		}
	}
	int biggest = arr[0];
	for (int i = 0; i < 256; i++)
	{
		if (arr[i] > biggest) {
			biggest = arr[i];
		}
	}
	int out_row = biggest * 1.2;
	int out_col = 256;
	Mat out = Mat(out_row, out_col, CV_8UC1);
	for (int i = 0; i < out_row;i++)
	{
		for (int j = 0; j < out_col; j++) {
			if (i <= arr[j]) {
				//index start with 0 !!!!!!!
				out.at<uchar>(out.rows-i-1, j) = 255;
			}
			else {
				out.at<uchar>(out.rows-i-1, j) = 0;
			}
		}
	
	}
	imshow("hist", out);
}
```
