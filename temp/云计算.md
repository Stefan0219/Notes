# 云计算第二次实习 HDFS
* 班级：计科2003
* 姓名 : 田沛骐
* 学号 ：2020014457
# 实验环境
1. Hadoop 2.7.1
2. Eclipse 4.8.0。
3. CourseGrading 在线实验环境。 
4.  安装三个数据节点的 Hadoop 集群。
# 实验内容与完成情况
## 实验准备
### 环境配置
1. 安装部署 Hadoop 集群 安装三个数据节点的 Hadoop 集群（master、slave1、slave2、slave3）, 并启动。
 ```bash
 $ docker start master 
 $ docker start slave1 
 $ docker start slave2 
 $ docker start slave3 
 $ start-dfs.sh 
 $ start-yarn.sh 
 $ mr-jobhistory-daemon.sh start historyserver
```
2.  建立 hdfs 项目。路径为：
```bash
/headless/course/hadoop/hdfs_pro 
```
## 基本操作
1.  掌握目录、文件的相关操作 
* 创建目录 
```JAVA
public abstract boolean mkdirs(Path f, FsPermission permission) throws IOException 
```

 * 目录存在性判断 
 ```JAVA
public boolean exists(Path f) throws IOException
	```

 *  列出目录中的内容 ✞
 ```java
public abstract FileStatus[] listStatus(Path f) throws FileNotFoundException, IOException
```

*  删除目录 ✞ 
```java
public abstract boolean delete(Path f,boolean recursive) throws IOException
```
* 创建文件 
```java
public FSDataOutputStream create(Path f) throws IOException
```
* 文件存在性判断
```java
public boolean exists(Path f) throws IOException
``` 
* 文件写 
```java

```public FSDataOutputStream append(Path f) throws IOException ✍✝ ✆ 2.2.8 文件读 ✞ public abstract FSDataInputStream open(Path f,int bufferSize) throws IOException ✍✝ ✆ 2.2.9 文件移动或重命名 ✞ public abstract boolean rename(Path src,Path dst) 主讲教师：张海曦 第 4 页 2.3 实验过程 实验二 HDFS 实验 2 throws IOException ✍✝ ✆ 2.2.10 文件删除 ✞ public abstract boolean delete(Path f,boolean recursive) throws IOException ✍✝ ✆ 2.3 实验过程 2.3.1 基本设计方案 根据 String[] args 的输入的参数数量，种类判断需要执行的命令。 2.3.2 代码实现 1. 使用 HShell -cp 本地路径 HDFS 路径，将文件从 Linux 本地文件系 统拷贝到 HDFS 指定路径上 ✞ if(str.equals("-cp")&&n==3) { String input = args[1]; String output = args[2]; Path path1 = new Path(input); Path path2 = new Path(output); fs.copyFromLocalFile(path1, path2); System.out.println("File"+input+"has been copyed successfully!"); } ✍✝ ✆ 主讲教师：张海曦 第 5 页 2.3 实验过程 实验二 HDFS 实验 2 图 1: 文件拷贝测试结果 采用 fs 中的 copyFromLocalFile 进行本地远程拷贝。为了区别文件夹 拷贝，在判断第一个参数为-cp 的同时，还应判断输入参数数量，相 比于文件夹缺少-r, 因此参数数量为 3，实验结果如 fig1。 2. 使用 HShell -rm 路径删除文件 ✞ if(str.equals("-rm")&&n==2) { Path path = new Path(args[1]); if(fs.delete(path,false)) System.out.println("File"+args[1]+"has been deleted successfully!"); } ✍✝ ✆ 像文件拷贝一样，在判断第一个参数为-rm 的同时，还应判断输入参 数数量，相比于文件夹删除，缺少参数-r，因此参数数量为 2，实验结 果如 fig2。 主讲教师：张海曦 第 6 页 2.3 实验过程 实验二 HDFS 实验 2 图 2: 文件删除测试结果 3. 使用 HShell -cp -r 本地目录路径 HDFS 路径，将目录从 Linux 本地 拷贝到 HDFS 指定路径上 ✞ if(str.equals("-cp")&&args[1].equals("-r")) { Path input =new Path(args[2]); Path output= new Path(args[3]); fs.copyFromLocalFile(false, true, input, output); System.out.println("Directory"+args[2]+"has been copyed successfully!"); } ✍✝ ✆ 文件夹拷贝应将 fs.copyFromLocalFile 的前两个参数设为（false，true） 以区分文件拷贝，结果如 fig3。 主讲教师：张海曦 第 7 页 2.3 实验过程 实验二 HDFS 实验 2 图 3: 文件夹拷贝结果 4. 使用 HShell -rm -r 路径删除目录 ✞ if(str.equals("-rm")&&args[1].equals("-r")) { Path path = new Path(args[2]); if(fs.delete(path,true)) { System.out.println("Directory"+args[2]+"has been deleted successfully!"); } } ✍✝ ✆ 图 4: 文件夹删除测试结果 文件夹删除和文件删除命令一致，因此只需区分输入参数就可以实现 主讲教师：张海曦 第 8 页 2.3 实验过程 实验二 HDFS 实验 2 了，结果如 fig4。 5. 使用 HShell -list 路径显示某个文件的信息或者某个目录的信息 ✞ if(str.equals("-list")) { Path path = new Path(args[1]); FileStatus fileS = fs.getFileStatus(path); System.out.println(fileS.toString()); } ✍✝ ✆ 图 5: 文件路径信息显示结果 图 6: 文件夹路径信息显示结果 采用 fs 中的 getFileStatus() 实现，此命令文件夹和文件操作一致，参 数数量也一致，结果如 fig5、fig6。 6. 使用 HShell -mv 路径路径移动文件或者重命名文件 ✞ if(str.equals("-mv")) { Path p1 = new Path(args[1]); Path p2 = new Path(args[2]); fs.rename(p1, p2); 主讲教师：张海曦 第 9 页 2.3 实验过程 实验二 HDFS 实验 2 } ✍✝ ✆ 图 7: 文件重命名显示结果 图 8: 文件夹重命名显示结果
	